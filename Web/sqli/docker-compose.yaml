

services:
  # PHP and Apache service
  php-app:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "8003:80"
    read_only: true
    tmpfs:
      - /tmp
      - /run
      - /var/log
      - /var/log/apache2
      - /var/lib/php/sessions
    volumes:
      - ./src:/var/www/html:ro
    depends_on:
      - mariadb
    environment:
      DB_HOST: mariadb
      DB_USER: appuser
      DB_PASSWORD: apppassword
      DB_NAME: ctf_lab
    networks:
      - app-network

  # MariaDB service
  mariadb:
    image: mariadb:10.6
    restart: always
    ports:
      - "13306:3306"  
    environment:
      MYSQL_ROOT_PASSWORD: rootpassword
      MYSQL_DATABASE: ctf_lab
      MYSQL_USER: appuser
      MYSQL_PASSWORD: apppassword
    volumes:
      - ./database/init.sql:/docker-entrypoint-initdb.d/init.sql:ro
    read_only: true
    tmpfs:
      - /tmp
      - /run/mysqld
      - /var/lib/mysql
    networks:
      - app-network


# Network for the application
networks:
  app-network:
    driver: bridge
